<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Movies Aro</title>
<style>
:root {
  --yt-bg: #0f0f0f;
  --yt-surface: #181818;
  --yt-hover: #212121;
  --yt-text: #ffffff;
  --yt-muted: #aaaaaa;
  --yt-accent: #ff0000;
  --yt-border: #2a2a2a;
}

body {
  font-family: "Roboto", "Segoe UI", sans-serif;
  background-color: var(--yt-bg);
  color: var(--yt-text);
  margin: 0;
  padding: 20px;
}

.wrap {
  max-width: 960px;
  margin: 0 auto;
}

h1 {
  text-align: center;
  color: var(--yt-accent);
  font-size: 2.2rem;
  font-weight: 700;
  margin-bottom: 25px;
  text-transform: uppercase;
}

.controls {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
}

input[type="text"] {
  flex: 1;
  padding: 12px 14px;
  border-radius: 6px;
  border: 1px solid var(--yt-border);
  background: var(--yt-surface);
  color: var(--yt-text);
  font-size: 15px;
}
input[type="text"]::placeholder { color: var(--yt-muted); }

button {
  padding: 12px 18px;
  border-radius: 6px;
  border: none;
  background-color: var(--yt-accent);
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  transition: background 0.2s, transform 0.2s;
}
button:hover { background-color: #e60000; transform: translateY(-1px); }
button:disabled { opacity: 0.5; cursor: not-allowed; }

.hint {
  color: var(--yt-muted);
  font-size: 0.9rem;
  margin-bottom: 12px;
  text-align: center;
}

.result {
  background: var(--yt-surface);
  border: 1px solid var(--yt-border);
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 15px;
  transition: background 0.2s;
}
.result:hover { background: var(--yt-hover); }

.meta {
  font-size: 0.95rem;
  margin-bottom: 10px;
  white-space: pre-wrap;
}

.links {
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid var(--yt-border);
}
.links a {
  display: inline-block;
  background: var(--yt-hover);
  padding: 8px 12px;
  border-radius: 4px;
  margin: 5px 8px 0 0;
  color: var(--yt-text);
  text-decoration: none;
  transition: background 0.2s;
}
.links a:hover { background: var(--yt-accent); }

.error { color: #ff6b6b; font-weight: 600; }
.loading { color: var(--yt-muted); }

/* Buttons section */
.button-box {
  text-align: center;
  margin: 20px auto;
}
.button-box button {
  display: inline-block;
  margin: 8px;
  padding: 12px 24px;
  font-size: 15px;
  font-weight: 600;
  color: #fff;
  background-color: var(--yt-accent);
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.2s;
}
.button-box button:hover { background-color: #e60000; }

/* Video overlay player */
#videoOverlay {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.92);
  z-index: 9999;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}
#videoOverlay video {
  width: 90%;
  max-width: 900px;
  max-height: 80vh;
  background: black;
  border-radius: 10px;
}
#closeVideo {
  background: none;
  border: none;
  color: #fff;
  font-size: 1.3rem;
  margin-bottom: 10px;
  cursor: pointer;
}

/* Mobile */
@media (max-width: 600px) {
  h1 { font-size: 1.7rem; }
  .controls { flex-direction: column; }
  button { width: 100%; }
}
</style>
</head>

<body>
<div class="wrap">
  <h1>Movies Aro</h1>

  <div class="controls">
    <input type="text" id="q" placeholder="Type movie name...">
    <button id="searchBtn">Search</button>
  </div>

  <div class="hint">⌛ Please wait.. <span id="count">10</span> seconds before searching.</div>

  <div class="button-box">
    <button onclick="window.open('https://moviesaro.netlify.app','_self')">Go to Movies Aro (OLD)</button>
    <button onclick="window.open('https://moviesarodub.netlify.app','_self')">All Tamil Dubbed Movies</button>
  </div>

  <div id="output"></div>
</div>

<!-- YouTube-style video overlay -->
<div id="videoOverlay">
  <button id="closeVideo">✕ Close</button>
  <video id="videoPlayer" controls autoplay playsinline controlsList="nodownload"></video>
</div>

<script>
let t=10,el=document.getElementById("count");
let x=setInterval(()=>{ el.textContent=--t; if(t<=0) clearInterval(x); },1000);

function escapeHtml(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}

const yearlyFiles = [
  "1920.txt","1945.txt","1947.txt","1950.txt","1993.txt","1995.txt","1996.txt","1999.txt",
  "2003.txt","2005.txt","2007.txt","2008.txt","2009.txt","2010.txt","2012.txt","2013.txt",
  "2014.txt","2015.txt","2016.txt","2017.txt","2018.txt","2019.txt","2020.txt","2021.txt",
  "2022.txt","2023.txt","2024.txt","2025.txt","Unknown_Year.txt"
];

let files = [];

async function loadAllFiles() {
  for(const fname of yearlyFiles){
    try{
      const resp = await fetch(fname);
      const data = await resp.text();
      const rawBlocks = data.split('---').map(b=>b.trim()).filter(Boolean);
      const parsed = rawBlocks.map(block=>{
        const nameM = block.match(/File Name:\s*(.*)/i);
        const sizeM = block.match(/File Size:\s*(.*)/i);
        const linkM = block.match(/Download Link:\s*(.*)/i);
        return { name: nameM?nameM[1].trim(): '', size: sizeM?sizeM[1].trim():'', link: linkM?linkM[1].trim(): '' };
      }).filter(f=>f.name && f.size && f.link);
      files = files.concat(parsed);
    }catch(e){console.error("Failed to load",fname,e);}
  }
}

function renderResults(list){
  const outEl=document.getElementById('output');
  outEl.innerHTML='';
  if(!list.length){ outEl.innerHTML='<div class="error">No results found.</div>'; return; }
  list.forEach((f,idx)=>{
    const container=document.createElement('div'); container.className='result';
    container.innerHTML=`
      <div class="meta"><b>${escapeHtml(f.name)}</b><br>Size: ${escapeHtml(f.size)}</div>
      <button data-link="${escapeHtml(f.link)}" class="get-links">Show Play Servers</button>
      <div class="links" id="links-${idx}" aria-live="polite"></div>
    `;
    outEl.appendChild(container);
    const btn=container.querySelector('.get-links');
    const linksContainer=container.querySelector(`#links-${idx}`);
    btn.addEventListener('click', async ()=>{
      btn.disabled=true;
      const originalText=btn.textContent; btn.textContent='Loading...';
      linksContainer.innerHTML='';
      try{ await fetchAndShowDownloadDiv(btn.dataset.link, linksContainer); }
      catch(err){ linksContainer.innerHTML=`<div class="error">Error: ${escapeHtml(err.message||String(err))}</div>`; }
      finally{ btn.disabled=false; btn.textContent=originalText; }
    });
  });
}

async function fetchAndShowDownloadDiv(targetUrl, containerEl){
  containerEl.innerHTML='<div class="loading">Please Wait...</div>';
  const proxyUrl='https://api.allorigins.win/raw?url='+encodeURIComponent(targetUrl);
  let text;
  try{ const resp=await fetch(proxyUrl); if(!resp.ok) throw new Error(resp.status); text=await resp.text(); }
  catch(err){
    const fallback='https://api.codetabs.com/v1/proxy?quest='+encodeURIComponent(targetUrl);
    const r2=await fetch(fallback); if(!r2.ok) throw new Error(r2.status);
    text=await r2.text();
  }

  const parser=new DOMParser();
  const doc=parser.parseFromString(text,'text/html');
  let downloadDiv=doc.querySelector('.download');
  if(!downloadDiv){
    const m=text.match(/<div[^>]*class=["']?download["']?[^>]*>[\s\S]*?<\/div>/i);
    if(m&&m[0]) downloadDiv=parser.parseFromString(m[0],'text/html').body.firstElementChild;
  }
  if(!downloadDiv){ containerEl.innerHTML='<div class="error">No play section found.</div>'; return; }

  // Rename Download Servers → Play Servers
  containerEl.innerHTML = downloadDiv.outerHTML.replace(/Download Server/gi, "Play Server");

  containerEl.querySelectorAll('a').forEach(a=>{
    a.setAttribute('target','_blank');
    a.setAttribute('rel','noopener noreferrer');
    a.addEventListener('click', e=>{
      e.preventDefault();
      playVideo(a.href);
    });
  });
}

function playVideo(src){
  const overlay=document.getElementById('videoOverlay');
  const player=document.getElementById('videoPlayer');
  player.src=src;
  overlay.style.display='flex';
}

document.getElementById('closeVideo').addEventListener('click',()=>{
  const overlay=document.getElementById('videoOverlay');
  const player=document.getElementById('videoPlayer');
  player.pause(); player.src='';
  overlay.style.display='none';
});

const qEl=document.getElementById('q');
const searchBtn=document.getElementById('searchBtn');
function doSearch(){
  const q=qEl.value.trim();
  if(!q){ document.getElementById('output').innerHTML='<div class="hint">Type a search term.</div>'; return; }
  const filtered=files.filter(f=>f.name.toLowerCase().includes(q.toLowerCase()));
  renderResults(filtered);
}
searchBtn.addEventListener('click', doSearch);
qEl.addEventListener('keydown', e=>{ if(e.key==='Enter') doSearch(); });

async function init(){
  await loadAllFiles();
  const params=new URLSearchParams(window.location.search);
  const query=params.get("q");
  if(query){ qEl.value=query; doSearch(); }
}
init();
</script>
</body>
</html>
